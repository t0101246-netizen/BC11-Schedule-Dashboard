<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P6 å°ˆæ¡ˆæ’ç¨‹å„€è¡¨æ¿ (GitHubç‰ˆ)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body { margin: 0; padding: 20px; font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; background-color: #f4f4f4; }
        
        /* --- 1. å¯†ç¢¼é®ç½©å±¤æ¨£å¼ --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex; justify-content: center; align-items: center;
            z-index: 9999;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 12px;
            box-shadow: 0 0 25px rgba(0,0,0,0.7); text-align: center; width: 320px;
        }
        .login-box h3 { margin-top: 0; color: #333; margin-bottom: 20px;}
        .login-box input {
            width: 100%; padding: 12px; margin: 10px 0;
            box-sizing: border-box; border: 2px solid #ddd; border-radius: 6px;
            font-size: 18px; text-align: center; letter-spacing: 2px;
        }
        .login-box button {
            width: 100%; padding: 12px; background-color: #1f77b4;
            color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-top: 10px;
            transition: background 0.3s;
        }
        .login-box button:hover { background-color: #155a8a; }
        #error-msg { color: #d62728; font-size: 0.9em; margin-top: 15px; display: none; font-weight: bold;}

        /* --- 2. ä¸»å…§å®¹å€åŸŸ --- */
        #main-content { display: none; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        
        h2 { text-align: center; color: #333; margin-bottom: 10px; }
        
        /* åˆ‡æ›æŒ‰éˆ•å€ */
        .nav-buttons { text-align: center; margin-bottom: 20px; }
        .btn-toggle {
            padding: 10px 20px; margin: 0 5px; cursor: pointer;
            border: 2px solid #1f77b4; background: white; color: #1f77b4;
            border-radius: 5px; font-weight: bold; font-size: 16px;
            transition: all 0.3s;
        }
        .btn-toggle:hover { background: #eef; }
        .btn-toggle.active {
            background: #1f77b4; color: white;
        }

        .info { text-align: center; color: #666; margin-bottom: 15px; font-size: 0.95em; background: #eef; padding: 15px; border-radius: 4px; border-left: 5px solid #1f77b4;}
        
        #gantt-chart { width: 100%; min-height: 800px; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h3>ğŸ”’ å°ˆæ¡ˆæ’ç¨‹ç³»çµ±</h3>
        <input type="password" id="password-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" onkeyup="if(event.keyCode===13) checkPassword()">
        <button onclick="checkPassword()">è§£é–æª¢è¦–</button>
        <div id="error-msg">âš ï¸ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡è©¦</div>
    </div>
</div>

<div id="main-content">
    <div class="container">
        <h2>P6 å°ˆæ¡ˆæ’ç¨‹å‹•æ…‹å„€è¡¨æ¿</h2>
        
        <div class="nav-buttons">
            <button class="btn-toggle active" id="btn-full" onclick="switchView('full')">ğŸ“Š é¡¯ç¤ºå®Œæ•´æ’ç¨‹ (Full WBS)</button>
            <button class="btn-toggle" id="btn-cp" onclick="switchView('cp')">ğŸš© é¡¯ç¤ºé—œéµè·¯å¾‘ (CP Only)</button>
        </div>

        <div class="info" id="info-box">
            è¼‰å…¥ä¸­...
        </div>

        <div id="gantt-chart"></div>
    </div>
</div>

<script>
    // --- è³‡æ–™é›†å®šç¾© ---

    // 1. å®Œæ•´è³‡æ–™ (Full WBS)
    var fullTasks = [
        {id: "1000", name: "1000 å°ˆæ¡ˆå•Ÿå‹• (NTP) - æ±ºæ¨™ç°½ç´„", start: "2026-04-20", finish: "2026-04-20", group: "é‡Œç¨‹ç¢‘", color: "#d62728"},
        {id: "1010", name: "1010 æé€: æ•´é«”æ–½å·¥è¨ˆç•«æ›¸/å®‰è¡›è¨ˆç•«", start: "2026-04-21", finish: "2026-06-01", group: "è¨ˆç•«å¯©æŸ¥", color: "#1f77b4"},
        {id: "1020", name: "1020 æ ¸å®š: æ•´é«”æ–½å·¥è¨ˆç•«æ›¸", start: "2026-06-02", finish: "2026-07-13", group: "è¨ˆç•«å¯©æŸ¥", color: "#1f77b4"},
        {id: "1025", name: "1025 ç”³å ±: æ”¾æ¨£å‹˜é©—èˆ‡é–‹å·¥é€šå ±", start: "2026-07-14", finish: "2026-08-03", group: "è¡Œæ”¿ç¨‹åº", color: "#1f77b4"},
        {id: "1030", name: "1030 èª¿æŸ¥: é„°æˆ¿ç¾æ³é‘‘å®š", start: "2026-04-21", finish: "2026-06-22", group: "èª¿æŸ¥ä½œæ¥­", color: "#17becf"},
        {id: "1040", name: "1040 æé€: äº¤é€šç¶­æŒè¨ˆç•« (åˆç¨¿)", start: "2026-04-21", finish: "2026-06-01", group: "äº¤ç¶­è¨ˆç•«", color: "#9467bd"},
        {id: "1050", name: "1050 å¯©æŸ¥: äº¤é€šå±€/é“å®‰æœƒå ±ä¿®æ­£", start: "2026-06-02", finish: "2026-08-03", group: "äº¤ç¶­è¨ˆç•«", color: "#9467bd"},
        {id: "1060", name: "1060 æ ¸å®š: äº¤é€šç¶­æŒè¨ˆç•« (å®šç¨¿)", start: "2026-08-04", finish: "2026-09-14", group: "äº¤ç¶­è¨ˆç•«", color: "#9467bd"},
        {id: "1070", name: "1070 ç”³è¾¦/å–å¾—: æ¤æ ½ç§»æ¤è¨±å¯", start: "2026-04-21", finish: "2026-06-22", group: "è¡Œæ”¿ç¨‹åº", color: "#1f77b4"},
        {id: "2010", name: "2010 è©¦æ‹Œ: é æ‹Œæ··å‡åœŸé…æ¯”è¨­è¨ˆ", start: "2026-07-14", finish: "2026-09-07", group: "ææ–™è©¦é©—", color: "#17becf"},
        {id: "2020", name: "2020 æ ¸å®š: æ··å‡åœŸé…æ¯”è¨­è¨ˆå ±å‘Š", start: "2026-09-08", finish: "2026-10-05", group: "ææ–™è©¦é©—", color: "#17becf"},
        {id: "2030", name: "2030 æ–½ä½œ: å·¨ç©æ··å‡åœŸæ¨¡å‹è©¦é©—", start: "2026-10-06", finish: "2026-11-19", group: "ææ–™è©¦é©—", color: "#17becf"},
        {id: "3010", name: "3010 æ–½ä½œ: æ—¢æœ‰æ¤æ ½ç§»æ¤èˆ‡ä¿è­·", start: "2026-06-23", finish: "2026-08-03", group: "ç¾å ´å‰ç½®", color: "#2ca02c"},
        {id: "3020", name: "3020 ç”³è¾¦/å–å¾—: é“è·¯æŒ–æ˜è¨±å¯è­‰", start: "2026-09-15", finish: "2026-10-26", group: "è¡Œæ”¿ç¨‹åº", color: "#d62728"},
        {id: "3030", name: "3030 æ¶è¨­: æ–½å·¥åœç±¬ (Phase 1)", start: "2026-10-27", finish: "2026-11-23", group: "ç¾å ´å‰ç½®", color: "#2ca02c"},
        {id: "4010", name: "4010 è©¦æŒ–: åœ°ä¸‹ç®¡ç·šè©¦æŒ– (Trial Pits)", start: "2026-11-24", finish: "2026-12-21", group: "ç®¡ç·šè™•ç†", color: "#8c564b"},
        {id: "4020", name: "4020 æ’é™¤: åœ°ä¸‹éšœç¤™ç‰©è™•ç† (Zone A)", start: "2026-12-22", finish: "2027-02-15", group: "ç®¡ç·šè™•ç†", color: "#8c564b"},
        {id: "4021", name: "4021 æ’é™¤: åœ°ä¸‹éšœç¤™ç‰©è™•ç† (Zone B)", start: "2027-02-16", finish: "2027-04-12", group: "ç®¡ç·šè™•ç†", color: "#8c564b"},
        {id: "4030", name: "4030 åŸ‹è¨­: Bé¡ç®¡ç·š (ç‰¹é«˜å£“/è‡ªä¾†æ°´)", start: "2027-04-13", finish: "2027-06-07", group: "ç®¡ç·šè™•ç†", color: "#8c564b"},
        {id: "4040", name: "4040 åˆ‡æ›: ç®¡ç·šç©¿å»¢èˆ‡å…¬å‘Šæ–·ç®¡", start: "2027-10-01", finish: "2027-11-11", group: "ç®¡ç·šè™•ç†", color: "#8c564b"},
        {id: "4055", name: "4055 é‡Œç¨‹ç¢‘: ç¬¬ä¸€éšæ®µäº¤ç¶­æ”¹é“", start: "2027-11-12", finish: "2027-11-12", group: "é‡Œç¨‹ç¢‘", color: "#d62728"},
        {id: "4060", name: "4060 æ–½ä½œ: è©¦æ¨ (Test Pile) æ“´åº§èˆ‡æ¾†ç½®", start: "2027-11-13", finish: "2027-12-01", group: "è©¦æ¨å·¥ç¨‹", color: "#2ca02c"},
        {id: "4070", name: "4070 ç­‰å¾…: è©¦æ¨é¤Šæ²»æœŸ (Curing)", start: "2027-12-02", finish: "2027-12-08", group: "è©¦æ¨å·¥ç¨‹", color: "#2ca02c"},
        {id: "4080", name: "4080 æª¢æ¸¬: åŸºæ¨è¼‰é‡è©¦é©— (Load Test)", start: "2027-12-09", finish: "2027-12-22", group: "è©¦æ¨å·¥ç¨‹", color: "#2ca02c"},
        {id: "4090", name: "4090 æ ¸å®š: è©¦æ¨è¼‰é‡è©¦é©—å ±å‘Š", start: "2027-12-23", finish: "2028-01-11", group: "è©¦æ¨å·¥ç¨‹", color: "#2ca02c"},
        {id: "5010", name: "5010 æ–½ä½œ: å…¨å¥—ç®¡åŸºæ¨ (Zone A)", start: "2028-01-12", finish: "2028-02-22", group: "åŸºæ¨å·¥ç¨‹", color: "#2ca02c"},
        {id: "5020", name: "5020 æ–½ä½œ: å…¨å¥—ç®¡åŸºæ¨ (Zone B)", start: "2028-02-23", finish: "2028-04-05", group: "åŸºæ¨å·¥ç¨‹", color: "#2ca02c"},
        {id: "5030", name: "5030 æª¢æ¸¬/æ¨åº•çŒæ¼¿ (Base Grouting)", start: "2028-04-06", finish: "2028-05-03", group: "åŸºæ¨å·¥ç¨‹", color: "#2ca02c"},
        {id: "6010", name: "6010 æ–½ä½œ: æ¨å¸½é–‹æŒ–èˆ‡æ“‹åœŸ", start: "2028-05-04", finish: "2028-05-24", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "6020", name: "6020 ç•Œé¢: æ‰“è¨­æ¥åœ°éŠ…æ£’", start: "2028-05-25", finish: "2028-05-29", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "6030", name: "6030 æ–½ä½œ: PC æ¾†ç½®èˆ‡æ¨é ­è™•ç†", start: "2028-05-30", finish: "2028-06-07", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "6040", name: "6040 ç¶ç´®: æ¨å¸½é‹¼ç­‹ (å«å¢©æŸ±é ç•™ç­‹)", start: "2028-06-08", finish: "2028-06-21", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "6050", name: "6050 ç•Œé¢: æ¥åœ°ç¶²ç†”æ¥èˆ‡æ¸¬è©¦", start: "2028-06-22", finish: "2028-06-28", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "6060", name: "6060 çµ„ç«‹: æ¨å¸½æ¨¡æ¿", start: "2028-06-29", finish: "2028-07-05", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "6065", name: "6065 æŸ¥é©—: é‹¼ç­‹èˆ‡æ¨¡æ¿æŸ¥é©—", start: "2028-07-06", finish: "2028-07-06", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "6070", name: "6070 æ¾†ç½®: æ¨å¸½æ··å‡åœŸ", start: "2028-07-07", finish: "2028-07-07", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "6080", name: "6080 é¤Šè­·: æ¨å¸½æº«æ§é¤Šè­·", start: "2028-07-08", finish: "2028-07-14", group: "æ¨å¸½å·¥ç¨‹", color: "#ff7f0e"},
        {id: "7010", name: "7010 æ­è¨­: é‡å‹æ–½å·¥æ¶èˆ‡å·¥ä½œå¹³å°", start: "2028-07-15", finish: "2028-07-20", group: "å¢©æŸ±å·¥ç¨‹", color: "#ff7f0e"},
        {id: "7020", name: "7020 ç¶ç´®: å¢©æŸ±ç¬¬ä¸€å‡å±¤é‹¼ç­‹", start: "2028-07-21", finish: "2028-08-03", group: "å¢©æŸ±å·¥ç¨‹", color: "#ff7f0e"},
        {id: "7030", name: "7030 ç•Œé¢: é åŸ‹æ’æ°´ç®¡èˆ‡æ©Ÿé›»ç®¡è·¯", start: "2028-07-21", finish: "2028-07-25", group: "å¢©æŸ±å·¥ç¨‹", color: "#ff7f0e"},
        {id: "7040", name: "7040 çµ„ç«‹: å¢©æŸ±ç¬¬ä¸€å‡å±¤é‹¼æ¨¡", start: "2028-08-04", finish: "2028-08-10", group: "å¢©æŸ±å·¥ç¨‹", color: "#ff7f0e"},
        {id: "7050", name: "7050 æŸ¥é©—: å¢©æŸ±é‹¼ç­‹æ¨¡æ¿æŸ¥é©—", start: "2028-08-11", finish: "2028-08-11", group: "å¢©æŸ±å·¥ç¨‹", color: "#ff7f0e"},
        {id: "7060", name: "7060 æ¾†ç½®: å¢©æŸ±ç¬¬ä¸€å‡å±¤æ··å‡åœŸ", start: "2028-08-12", finish: "2028-08-12", group: "å¢©æŸ±å·¥ç¨‹", color: "#ff7f0e"},
        {id: "8000", name: "8000 é‡Œç¨‹ç¢‘: é”æˆå¢©æŸ±ç¬¬ä¸€å‡å±¤æ–½ä½œç›®æ¨™", start: "2028-08-12", finish: "2028-08-12", group: "é‡Œç¨‹ç¢‘", color: "#d62728"}
    ];

    // 2. é—œéµè·¯å¾‘è³‡æ–™ (CP Only - ç¯©é¸ç‰ˆ)
    var cpTasks = [
        {id: "1000", name: "1000 å°ˆæ¡ˆå•Ÿå‹• (NTP) - æ±ºæ¨™ç°½ç´„", start: "2026-04-20", finish: "2026-04-20", group: "é‡Œç¨‹ç¢‘", color: "#d62728"},
        {id: "1040", name: "1040 æé€: äº¤é€šç¶­æŒè¨ˆç•« (åˆç¨¿)", start: "2026-04-21", finish: "2026-06-01", group: "1.äº¤ç¶­è¨ˆç•« (CP)", color: "#9467bd"},
        {id: "1050", name: "1050 å¯©æŸ¥: äº¤é€šå±€/é“å®‰æœƒå ±ä¿®æ­£", start: "2026-06-02", finish: "2026-08-03", group: "1.äº¤ç¶­è¨ˆç•« (CP)", color: "#9467bd"},
        {id: "1060", name: "1060 æ ¸å®š: äº¤é€šç¶­æŒè¨ˆç•« (å®šç¨¿)", start: "2026-08-04", finish: "2026-09-14", group: "1.äº¤ç¶­è¨ˆç•« (CP)", color: "#9467bd"},
        {id: "3020", name: "3020 ç”³è¾¦/å–å¾—: é“è·¯æŒ–æ˜è¨±å¯è­‰", start: "2026-09-15", finish: "2026-10-26", group: "2.è¡Œæ”¿è¨±å¯ (CP)", color: "#d62728"},
        {id: "3030", name: "3030 æ¶è¨­: æ–½å·¥åœç±¬ (Phase 1)", start: "2026-10-27", finish: "2026-11-23", group: "3.ç¾å ´å‰ç½® (CP)", color: "#2ca02c"},
        {id: "4010", name: "4010 è©¦æŒ–: åœ°ä¸‹ç®¡ç·šè©¦æŒ– (Trial Pits)", start: "2026-11-24", finish: "2026-12-21", group: "4.ç®¡ç·šéšœç¤™ (CP)", color: "#8c564b"},
        {id: "4020", name: "4020 æ’é™¤: åœ°ä¸‹éšœç¤™ç‰©è™•ç† (Zone A)", start: "2026-12-22", finish: "2027-02-15", group: "4.ç®¡ç·šéšœç¤™ (CP)", color: "#8c564b"},
        {id: "4021", name: "4021 æ’é™¤: åœ°ä¸‹éšœç¤™ç‰©è™•ç† (Zone B)", start: "2027-02-16", finish: "2027-04-12", group: "4.ç®¡ç·šéšœç¤™ (CP)", color: "#8c564b"},
        {id: "4030", name: "4030 åŸ‹è¨­: Bé¡ç®¡ç·š (ç‰¹é«˜å£“/è‡ªä¾†æ°´)", start: "2027-04-13", finish: "2027-06-07", group: "4.ç®¡ç·šéšœç¤™ (CP)", color: "#8c564b"},
        {id: "4040", name: "4040 åˆ‡æ›: ç®¡ç·šç©¿å»¢ (å«å¤æœˆé™åˆ¶)", start: "2027-10-01", finish: "2027-11-11", group: "4.ç®¡ç·šéšœç¤™ (CP)", color: "#8c564b"},
        {id: "4055", name: "4055 é‡Œç¨‹ç¢‘: ç¬¬ä¸€éšæ®µäº¤ç¶­æ”¹é“", start: "2027-11-12", finish: "2027-11-12", group: "é‡Œç¨‹ç¢‘", color: "#d62728"},
        {id: "4060", name: "4060 æ–½ä½œ: è©¦æ¨ (Test Pile) æ“´åº§èˆ‡æ¾†ç½®", start: "2027-11-13", finish: "2027-12-01", group: "5.è©¦æ¨å·¥ç¨‹ (CP)", color: "#2ca02c"},
        {id: "4070", name: "4070 ç­‰å¾…: è©¦æ¨é¤Šæ²»æœŸ (Curing)", start: "2027-12-02", finish: "2027-12-08", group: "5.è©¦æ¨å·¥ç¨‹ (CP)", color: "#2ca02c"},
        {id: "4080", name: "4080 æª¢æ¸¬: åŸºæ¨è¼‰é‡è©¦é©— (Load Test)", start: "2027-12-09", finish: "2027-12-22", group: "5.è©¦æ¨å·¥ç¨‹ (CP)", color: "#2ca02c"},
        {id: "4090", name: "4090 æ ¸å®š: è©¦æ¨è¼‰é‡è©¦é©—å ±å‘Š", start: "2027-12-23", finish: "2028-01-11", group: "5.è©¦æ¨å·¥ç¨‹ (CP)", color: "#2ca02c"},
        {id: "5010", name: "5010 æ–½ä½œ: å…¨å¥—ç®¡åŸºæ¨ (Zone A)", start: "2028-01-12", finish: "2028-02-22", group: "6.çµæ§‹å·¥ç¨‹ (CP)", color: "#2ca02c"},
        {id: "6010", name: "6010 æ–½ä½œ: æ¨å¸½é–‹æŒ–èˆ‡æ“‹åœŸ", start: "2028-05-04", finish: "2028-05-24", group: "6.çµæ§‹å·¥ç¨‹ (CP)", color: "#ff7f0e"},
        {id: "6070", name: "6070 æ¾†ç½®: æ¨å¸½æ··å‡åœŸ", start: "2028-07-07", finish: "2028-07-07", group: "6.çµæ§‹å·¥ç¨‹ (CP)", color: "#ff7f0e"},
        {id: "7010", name: "7010 æ­è¨­: é‡å‹æ–½å·¥æ¶", start: "2028-07-15", finish: "2028-07-20", group: "6.çµæ§‹å·¥ç¨‹ (CP)", color: "#ff7f0e"},
        {id: "7060", name: "7060 æ¾†ç½®: å¢©æŸ±ç¬¬ä¸€å‡å±¤æ··å‡åœŸ", start: "2028-08-12", finish: "2028-08-12", group: "6.çµæ§‹å·¥ç¨‹ (CP)", color: "#ff7f0e"},
        {id: "8000", name: "8000 é‡Œç¨‹ç¢‘: é”æˆå¢©æŸ±ç¬¬ä¸€å‡å±¤æ–½ä½œç›®æ¨™", start: "2028-08-12", finish: "2028-08-12", group: "é‡Œç¨‹ç¢‘", color: "#d62728"}
    ];

    // --- åŠŸèƒ½é‚è¼¯ ---

    // 1. å¯†ç¢¼é©—è­‰
    function checkPassword() {
        var input = document.getElementById('password-input').value;
        var errorMsg = document.getElementById('error-msg');
        
        if (input === '2623') {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            // é è¨­è¼‰å…¥å®Œæ•´æ’ç¨‹
            switchView('full');
        } else {
            errorMsg.style.display = 'block';
            document.getElementById('password-input').value = '';
            document.getElementById('password-input').focus();
        }
    }

    // 2. åˆ‡æ›è¦–åœ–æ§åˆ¶
    function switchView(mode) {
        // æ›´æ–°æŒ‰éˆ•æ¨£å¼
        var btnFull = document.getElementById('btn-full');
        var btnCp = document.getElementById('btn-cp');
        var infoBox = document.getElementById('info-box');

        if (mode === 'full') {
            btnFull.classList.add('active');
            btnCp.classList.remove('active');
            infoBox.innerHTML = "<strong>ğŸ“Š å®Œæ•´ç‰ˆæª¢è¦– (Full WBS)</strong><br>åŒ…å«ï¼šè¡Œæ”¿ã€ç®¡ç·šã€è©¦æ¨ã€å…¨å¥—ç®¡åŸºæ¨ã€æ¨å¸½ã€å¢©æŸ±å®Œæ•´å·¥åº (45é …)";
            infoBox.style.borderLeftColor = "#1f77b4";
            renderChart(fullTasks, 'full');
        } else {
            btnCp.classList.add('active');
            btnFull.classList.remove('active');
            infoBox.innerHTML = "<strong>ğŸš© é—œéµè·¯å¾‘æª¢è¦– (Critical Path)</strong><br>é¡¯ç¤ºå°ˆæ¡ˆé©…å‹•éˆï¼šäº¤ç¶­è¨ˆç•« â” è·¯è­‰ â” ç®¡ç·šé·ç§»(å¤æœˆé™åˆ¶) â” è©¦æ¨ â” çµæ§‹é«”";
            infoBox.style.borderLeftColor = "#d62728";
            renderChart(cpTasks, 'cp');
        }
    }

    // 3. ç¹ªåœ–æ ¸å¿ƒå‡½æ•¸
    function renderChart(dataSet, mode) {
        // æ·±æ‹·è²è³‡æ–™ä»¥åè½‰é †åº (Plotly Bar å¾ä¸‹å¾€ä¸Šç•«)
        var tasks = JSON.parse(JSON.stringify(dataSet));
        tasks.reverse();

        // å…±é€šè¨­å®š
        var xData = tasks.map(t => new Date(t.finish) - new Date(t.start) + 86400000);
        var baseData = tasks.map(t => t.start);
        var yData = tasks.map(t => t.name);
        var colorData = tasks.map(t => t.color);
        var hoverData = tasks.map(t => 
            `<b>${t.name}</b><br>é–‹å§‹: ${t.start}<br>å®Œæˆ: ${t.finish}<br>åˆ†é¡: ${t.group}`
        );

        // ä¾æ“šæ¨¡å¼èª¿æ•´ Trace (è»Œè·¡) è¨­å®š
        var trace = {
            type: 'bar',
            orientation: 'h',
            x: xData,
            base: baseData,
            y: yData,
            marker: {
                color: colorData,
                opacity: 0.8,
                line: { width: 1, color: '#333' }
            },
            hoverinfo: 'text',
            hovertext: hoverData
        };

        if (mode === 'cp') {
            // CP æ¨¡å¼ï¼šæ–‡å­—é¡¯ç¤ºåœ¨ Bar ä¸Šï¼Œä¸¦è‡ªå‹•éš±è—æ»‘æ¡¿æ–‡å­—
            trace.text = yData; // é¡¯ç¤ºä½œæ¥­åç¨±
            trace.textposition = 'auto';
            trace.insidetextanchor = 'start';
            trace.textfont = { family: 'Microsoft JhengHei', color: 'black', size: 12 };
            // æ³¨æ„ï¼šä¸è¨­å®š constraintext: 'none'ï¼Œè®“ Plotly è‡ªå‹•éš±è—æ»‘æ¡¿å€éå°çš„æ–‡å­—
        } else {
            // Full æ¨¡å¼ï¼šæ–‡å­—é¡¯ç¤º Groupï¼Œæ¨™æº–æ¨£å¼
            trace.text = tasks.map(t => t.group);
            trace.textposition = 'auto'; // é è¨­
        }

        // ä¾æ“šæ¨¡å¼èª¿æ•´ Layout (ä½ˆå±€) è¨­å®š
        var layout = {
            height: (mode === 'full') ? 1500 : 900, // é«˜åº¦èª¿æ•´
            xaxis: {
                title: 'æ—¥æœŸ',
                type: 'date',
                tickformat: '%Y-%m',
                automargin: true,
                side: 'top',
                rangeslider: {visible: true},
                gridcolor: '#eee'
            },
            yaxis: {
                automargin: true,
                tickfont: {size: 11},
                showgrid: true
            },
            margin: {l: 300, r: 50, t: 50, b: 50},
            hovermode: 'closest',
            dragmode: 'pan'
        };

        Plotly.newPlot('gantt-chart', [trace], layout);
    }
</script>

</body>
</html>